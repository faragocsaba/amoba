<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amőba AI Aréna</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background-color: #f0f0f0; margin: 0; padding: 20px; }
        h1 { color: #333; }
        #controls { margin-bottom: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 0 10px; border: none; border-radius: 5px; transition: background 0.3s; }
        #btn-minimax { background-color: #e1f5fe; color: #0277bd; }
        #btn-mcts { background-color: #e8f5e9; color: #2e7d32; }
        #btn-minimax:disabled, #btn-mcts:disabled { background-color: #ccc; color: #666; cursor: not-allowed; }
        #game-area { display: inline-block; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        canvas { cursor: crosshair; transition: background-color 0.3s; }
        #status { font-size: 18px; font-weight: bold; margin: 15px 0; min-height: 24px; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.1); display: flex; justify-content: center; align-items: center; color: #555; font-size: 24px; font-weight: bold; pointer-events: none; opacity: 0; transition: opacity 0.3s; }
        .overlay.active { opacity: 1; pointer-events: auto; }
    </style>
</head>
<body>

    <h1>Amőba AI Aréna</h1>

    <div id="controls">
        <button id="btn-minimax" onclick="startGame('minimax')">Minimax AI (Számító)</button>
        <button id="btn-mcts" onclick="startGame('montecarlo')">Monte-Carlo AI (Statisztikus)</button>
    </div>

    <div id="status">Válassz ellenfelet a kezdéshez!</div>

    <div id="game-area">
        <canvas id="board" width="450" height="450"></canvas>
        <div id="overlay" class="overlay active">Válassz AI-t<br>a kezdéshez!</div>
    </div>

    <script>
        const API_URL = "/move";

        const BOARD_SIZE = 10;
        const CELL_SIZE = 40;
        const OFFSET = 25;

        const COLOR_ACTIVE = "#F0D9B5";
        const COLOR_INACTIVE = "#D3D3D3";

        const canvas = document.getElementById('board');
        const ctx = canvas.getContext('2d');
        const statusLbl = document.getElementById('status');
        const overlay = document.getElementById('overlay');

        let board = [];
        let gameActive = false;
        let aiType = null;
        let isProcessing = false;

        function initBoard() {
            board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill('.'));
            drawBoard();
        }

        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = gameActive ? COLOR_ACTIVE : COLOR_INACTIVE;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = "black";
            ctx.lineWidth = 1;

            for (let i = 0; i < BOARD_SIZE; i++) {
                ctx.beginPath();
                ctx.moveTo(OFFSET, OFFSET + i * CELL_SIZE + CELL_SIZE/2);
                ctx.lineTo(OFFSET + BOARD_SIZE * CELL_SIZE, OFFSET + i * CELL_SIZE + CELL_SIZE/2);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(OFFSET + i * CELL_SIZE + CELL_SIZE/2, OFFSET);
                ctx.lineTo(OFFSET + i * CELL_SIZE + CELL_SIZE/2, OFFSET + BOARD_SIZE * CELL_SIZE);
                ctx.stroke();

                ctx.fillStyle = "black";
                ctx.font = "10px Arial";
                ctx.fillText(i, OFFSET/4, OFFSET + i * CELL_SIZE + CELL_SIZE/2 + 3);
                ctx.fillText(i, OFFSET + i * CELL_SIZE + CELL_SIZE/2 - 3, OFFSET/2);
            }

            // Kövek rajzolása
            for (let r = 0; r < BOARD_SIZE; r++) {
                for (let c = 0; c < BOARD_SIZE; c++) {
                    if (board[r][c] !== '.') {
                        drawStone(r, c, board[r][c] === 'X' ? 'black' : 'white');
                    }
                }
            }
        }

        function drawStone(r, c, color) {
            const x = OFFSET + c * CELL_SIZE + CELL_SIZE/2;
            const y = OFFSET + r * CELL_SIZE + CELL_SIZE/2;
            const radius = (CELL_SIZE / 2) - 4;
            ctx.beginPath(); ctx.arc(x, y, radius, 0, 2 * Math.PI); ctx.fillStyle = color; ctx.fill(); ctx.stroke();
        }

        function startGame(type) {
            aiType = type;
            gameActive = true;
            isProcessing = false;

            document.getElementById('btn-minimax').disabled = true;
            document.getElementById('btn-mcts').disabled = true;
            statusLbl.innerText = `Játék: Te (X) vs ${type === 'minimax' ? 'Minimax' : 'Monte-Carlo'} (O)`;
            overlay.classList.remove('active');

            initBoard();
        }

        function endGame(message) {
            gameActive = false;
            statusLbl.innerText = message;

            document.getElementById('btn-minimax').disabled = false;
            document.getElementById('btn-mcts').disabled = false;

            alert(message);

            overlay.innerHTML = "Játék vége!<br>Válassz ellenfelet.";
            overlay.classList.add('active');
            drawBoard();
        }

        canvas.addEventListener('click', async (e) => {
            if (!gameActive || isProcessing) return;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left - OFFSET;
            const y = e.clientY - rect.top - OFFSET;

            if (x < 0 || y < 0) return;

            const col = Math.floor(x / CELL_SIZE);
            const row = Math.floor(y / CELL_SIZE);

            if (row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE && board[row][col] === '.') {
                // Ember lépése
                board[row][col] = 'X';
                drawBoard();

                isProcessing = true;
                statusLbl.innerText = "A Gép gondolkodik...";
                document.body.style.cursor = "wait";

                try {
                    const response = await fetch(API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ board: board, ai_type: aiType })
                    });

                    if (!response.ok) throw new Error("Hiba a szerver kommunikációban");
                    const data = await response.json();

                    if (data.winner === 'X') { endGame("Gratulálok, nyertél!"); return; }

                    if (data.row !== -1) {
                        board[data.row][data.col] = 'O';
                        drawBoard();
                        // Utolsó lépés jelölése
                        const cx = OFFSET + data.col * CELL_SIZE + CELL_SIZE/2;
                        const cy = OFFSET + data.row * CELL_SIZE + CELL_SIZE/2;
                        ctx.beginPath(); ctx.arc(cx, cy, 5, 0, 2*Math.PI); ctx.fillStyle="red"; ctx.fill();
                    }

                    if (data.winner === 'O') endGame("A gép nyert!");
                    else if (data.winner === 'DRAW') endGame("Döntetlen!");
                    else statusLbl.innerText = "Te lépsz!";

                } catch (err) {
                    console.error(err);
                    statusLbl.innerText = "Hiba történt.";
                } finally {
                    isProcessing = false;
                    document.body.style.cursor = "default";
                }
            }
        });

        canvas.width = BOARD_SIZE * CELL_SIZE + OFFSET + 10;
        canvas.height = BOARD_SIZE * CELL_SIZE + OFFSET + 10;

        gameActive = false;
        initBoard();
    </script>
</body>
</html>
